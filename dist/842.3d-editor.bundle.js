"use strict";(self.webpackChunksd_webui_3d_editor=self.webpackChunksd_webui_3d_editor||[]).push([[842],{8842:function(e,s,t){t.r(s),t.d(s,{TDSLoader:function(){return i}});var a=t(9477);class i extends a.aNw{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,s,t,i){const r=this,n=""===this.path?a.Zp0.extractUrlBase(e):this.path,d=new a.hH6(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,(function(t){try{s(r.parse(t,n))}catch(s){i?i(s):console.error(s),r.manager.itemError(e)}}),t,i)}parse(e,s){this.group=new a.ZAu,this.materials=[],this.meshes=[],this.readFile(e,s);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,s){const t=new DataView(e),a=new r(t,0,this.debugMessage);if(a.id===d||a.id===h||a.id===n){let e=a.readChunk();for(;e;){if(e.id===o){const s=e.readDWord();this.debugMessage("3DS file version: "+s)}else e.id===f?this.readMeshData(e,s):this.debugMessage("Unknown main chunk: "+e.hexId);e=a.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,s){let t=e.readChunk();for(;t;){if(t.id===b){const e=+t.readDWord();this.debugMessage("Mesh Version: "+e)}else if(t.id===m){const e=t.readFloat();this.debugMessage("Master scale: "+e),this.group.scale.set(e,e,e)}else t.id===_?(this.debugMessage("Named Object"),this.readNamedObject(t)):t.id===k?(this.debugMessage("Material"),this.readMaterialEntry(t,s)):this.debugMessage("Unknown MDATA chunk: "+t.hexId);t=e.readChunk()}}readNamedObject(e){const s=e.readString();let t=e.readChunk();for(;t;){if(t.id===j){const e=this.readMesh(t);e.name=s,this.meshes.push(e)}else this.debugMessage("Unknown named object chunk: "+t.hexId);t=e.readChunk()}}readMaterialEntry(e,s){let t=e.readChunk();const i=new a.xoR;for(;t;){if(t.id===w)i.name=t.readString(),this.debugMessage("   Name: "+i.name);else if(t.id===U)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(t.id===D){const e=t.readByte();i.wireframeLinewidth=e,this.debugMessage("   Wireframe Thickness: "+e)}else if(t.id===I)i.side=a.ehD,this.debugMessage("   DoubleSided");else if(t.id===S)this.debugMessage("   Additive Blending"),i.blending=a.WMw;else if(t.id===C)this.debugMessage("   Diffuse Color"),i.color=this.readColor(t);else if(t.id===x)this.debugMessage("   Specular Color"),i.specular=this.readColor(t);else if(t.id===y)this.debugMessage("   Ambient color"),i.color=this.readColor(t);else if(t.id===F){const e=this.readPercentage(t);i.shininess=100*e,this.debugMessage("   Shininess : "+e)}else if(t.id===W){const e=this.readPercentage(t);i.opacity=1-e,this.debugMessage("  Transparency : "+e),i.transparent=i.opacity<1}else t.id===B?(this.debugMessage("   ColorMap"),i.map=this.readMap(t,s)):t.id===A?(this.debugMessage("   BumpMap"),i.bumpMap=this.readMap(t,s)):t.id===O?(this.debugMessage("   OpacityMap"),i.alphaMap=this.readMap(t,s)):t.id===R?(this.debugMessage("   SpecularMap"),i.specularMap=this.readMap(t,s)):this.debugMessage("   Unknown material chunk: "+t.hexId);t=e.readChunk()}this.materials[i.name]=i}readMesh(e){let s=e.readChunk();const t=new a.u9r,i=new a.xoR,r=new a.Kj0(t,i);for(r.name="mesh";s;){if(s.id===V){const e=s.readWord();this.debugMessage("   Vertex: "+e);const i=[];for(let t=0;t<e;t++)i.push(s.readFloat()),i.push(s.readFloat()),i.push(s.readFloat());t.setAttribute("position",new a.a$l(i,3))}else if(s.id===z)this.readFaceArray(s,r);else if(s.id===q){const e=s.readWord();this.debugMessage("   UV: "+e);const i=[];for(let t=0;t<e;t++)i.push(s.readFloat()),i.push(s.readFloat());t.setAttribute("uv",new a.a$l(i,2))}else if(s.id===E){this.debugMessage("   Tranformation Matrix (TODO)");const e=[];for(let t=0;t<12;t++)e[t]=s.readFloat();const i=new a.yGw;i.elements[0]=e[0],i.elements[1]=e[6],i.elements[2]=e[3],i.elements[3]=e[9],i.elements[4]=e[2],i.elements[5]=e[8],i.elements[6]=e[5],i.elements[7]=e[11],i.elements[8]=e[1],i.elements[9]=e[7],i.elements[10]=e[4],i.elements[11]=e[10],i.elements[12]=0,i.elements[13]=0,i.elements[14]=0,i.elements[15]=1,i.transpose();const n=new a.yGw;n.copy(i).invert(),t.applyMatrix4(n),i.decompose(r.position,r.quaternion,r.scale)}else this.debugMessage("   Unknown mesh chunk: "+s.hexId);s=e.readChunk()}return t.computeVertexNormals(),r}readFaceArray(e,s){const t=e.readWord();this.debugMessage("   Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();s.geometry.setIndex(a);let i=0,r=0;for(;!e.endOfChunk;){const t=e.readChunk();if(t.id===L){this.debugMessage("      Material Group");const e=this.readMaterialGroup(t),a=3*e.index.length;s.geometry.addGroup(r,a,i),r+=a,i++;const n=this.materials[e.name];!1===Array.isArray(s.material)&&(s.material=[]),void 0!==n&&s.material.push(n)}else this.debugMessage("      Unknown face array chunk: "+t.hexId)}1===s.material.length&&(s.material=s.material[0])}readMap(e,s){let t=e.readChunk(),i={};const r=new a.dpR(this.manager);for(r.setPath(this.resourcePath||s).setCrossOrigin(this.crossOrigin);t;){if(t.id===G){const e=t.readString();i=r.load(e),this.debugMessage("      File: "+s+e)}else t.id===T?(i.offset.x=t.readFloat(),this.debugMessage("      OffsetX: "+i.offset.x)):t.id===v?(i.offset.y=t.readFloat(),this.debugMessage("      OffsetY: "+i.offset.y)):t.id===N?(i.repeat.x=t.readFloat(),this.debugMessage("      RepeatX: "+i.repeat.x)):t.id===P?(i.repeat.y=t.readFloat(),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+t.hexId);t=e.readChunk()}return i}readMaterialGroup(e){const s=e.readString(),t=e.readWord();this.debugMessage("         Name: "+s),this.debugMessage("         Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord());return{name:s,index:a}}readColor(e){const s=e.readChunk(),t=new a.Ilk;if(s.id===g||s.id===l){const e=s.readByte(),a=s.readByte(),i=s.readByte();t.setRGB(e/255,a/255,i/255),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else if(s.id===u||s.id===c){const e=s.readFloat(),a=s.readFloat(),i=s.readFloat();t.setRGB(e,a,i),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else this.debugMessage("      Unknown color chunk: "+s.hexId);return t}readPercentage(e){const s=e.readChunk();switch(s.id){case p:return s.readShort()/100;case M:return s.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+s.hexId),0}}debugMessage(e){this.debug&&console.log(e)}}class r{constructor(e,s,t){this.data=e,this.offset=s,this.position=s,this.debugMessage=t,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+s)}readChunk(){if(this.endOfChunk)return null;try{const e=new r(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{const e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){const e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){const e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){const e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){const e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",s=this.readByte();for(;s;)e+=String.fromCharCode(s),s=this.readByte();return e}}const n=19789,d=15786,h=49725,o=2,u=16,g=17,l=18,c=19,p=48,M=49,f=15677,b=15678,m=256,k=45055,w=40960,y=40976,C=40992,x=41008,F=41024,W=41040,I=41089,S=41091,U=41093,D=41095,B=41472,O=41488,A=41520,R=41476,G=41728,N=41812,P=41814,T=41816,v=41818,_=16384,j=16640,V=16656,z=16672,L=16688,q=16704,E=16736}}]);